2016-10-28 Disk available at Sanger to host ensembldb/masrtdb for release 87
EBI DBA to let us know if moving just martdb before then is achievable or not. 

2016-10-24 martdb data copied to production instance

2016-10-21 Copying mysql5 martdb to mysql-hhvm7-005 at /instances/5316
We have 22TB currently on that.

2016-10-20 The VMs for 5 shards are requested
DBAs to configure them as soon as they arrive. External access needs to be configured by the network team.

Given the uncertainties on sharding, they don't know whether the end-of-October migration deadline can be met.

One suggestion would be if Sanger haven't got any space is to migrate martdb.ensembl.org soon, freeing up disc space at Sanger and giving us more time to move ensembldb.ensembl.org.

The 43.6TB archive of r48-86 presents a problem. The sql-aware proxy (ProxySQL) will not allow cross-database (cross-release) queries and would require tables to be fully-qualified in each query, ie 'db_name.table_name' rather than 'use db_name; select ... from table_name;'. We need to establish how big a problem this presents.
Not being able to support cross database queries is not that significant a problem, but having to have fully qualified table names is a show stopper (our APIs have not been designed to create namespaced queries).

An alternative to using a proxy would be to instruct the anonymous sql-user to go to server-x for a certain set of releases and to server-y for the next set, etc. DBAs don't know whether this is feasible. As long as it's transparent for users, ie they connect on 3306/5306 and the loadbalancer or proxy does the rest, then this would work. If technically possible.


2016-10-18 Shard test set up
s1 releases 48-63, 10.2TB

s2 releases 64-71, 9.6TB

s3 releases 72-77, 9.2TB

s4 releases 78-83, 9.1TB

s5 releases 84-86, 4.7TB, perhaps with 6.5TB allocated to allow space for release 87

We monitor the VMs with Nagios and will keep a load history. Within the database instance we can switch on the slow query log (but not the general log) and possibly use Nagios plug-ins. We could consider finer resolution for the more recent releases (eg s5 for 84-85, s6 for 86 and then s7 for 87) to gauge their popularity more accurately. We're already stretching the originally-envisaged resources by sharding, it's just a case how far we want/can afford to take that; a single, monolithic server (whether at Sanger or EBI) could never scale to handle an infinite stream of releases.

We do not currently have enough disc space at Sanger for release 87 (due 29th November).The priority is to migrate this ASAP so five shards for now sounds good.

We will need to patch the 87 databases from 5.1 to 5.6 (they are being produced at Sanger one last time).

We should also keep an eye on the main martdb.ensembl.org instance; that will reach 25Tb in about June of next year 

2016-10-10 DBA to request the VMs and build a test set up this week
Steve has provided the sizes of the different releases to let DBA do that.

2016-10-07 No feedback from www-prod re load balancing for public MySQL servers

2016-10-07 VMs for ensembldb/martdb ready
We have VMs for ensembldb and martdb with the exception of ensembldb port 3306/5306. 

The cloud team have strong reservations about having a 40+Tb volume so we're looking into alternatives (either don't continue to provide all databases or we use MySQL sharding). 

2016-09-27 Public MySQL instance VM names
We should suggest these:

mysql-ens-publicsql-NN (01-06)

mysql-ens-publicmart-NN (01-04) 

We assume there still be a single external alias (ensembldb.ensembl.org) to a load balancer
Actually, two aliases - ensembldb and martdb, with the port being used to direct to the correct server. Note this setup has not been discussed with web-production. It needs to work though to maintain current service 

2016-09-06 Meeting with EBI DBA about deployment
Summary from meeting with Andy B:

Agreed to have data duplication so that we can have failover between HH and HX 
Andy B will request 2 x 5 VMs (in the 'Rogue State') with appropriate disc, other resources (CPU, RAM) to be decided later, and reviewed once in production.
Steve to report on AWS resources
We're generally following the setup of eg-publicsql.ebi.ac.uk, with the expectation of production taking over routine updating.
Steve to request MySQL4 binary and mysql conf from Sanger. Will see if we can up the no of connections allowed from 1024 to 2048
We will copy data from /nfs to the instances, with a recopy after the 86 DBs are ready
Enable query log on MySQL4 instances to see if they are used; can disable ourselves if reqd.
We will have access to the filesystem as ens-mysql user, so will be also able to look at the slow query log if we want to.
Andy B is going to look into other ways of accessing user stats - oracle enterprise and load balancer logs.
Aim is to switch DNS in Oct/Nov.
If the 87 databases need patching (5.1 to 5.6) these will be done seperately from the others using a test instance.
No live backups of MySQL4 instances, and unlikely to need live backups of MySQL5 instances

2016-09-02 Migration update
ensembldb/martdb - we have the data here and we are in contact with the EBI DBAs, but at this moment we can't be sure of being able to run these services from EBI in time for the next release (86) due in 3 weeks time. Plan is therefore to release 86 on Sanger and migrate as soon after that as we can. 

Steve has requested meeting with EBI DBA to figure out how to deploy instances now that we have data and HW

2016-08-24 ensembldb transfer finished
ensembldb transfer finished, archive databases for embassy are all at /nfs/ensemblarch/db/ensembldb.
mart DB transfer still going.

2016-08-18 Migration strategy and transfer updates
Migration strategy: ask/set up two services/2 servers, request 2 VMs each in HX/HH (fail over), upgrade to 5.6 from 5.1 at EBI, keep MySQL 4 (need to request). Aiming at e!86 (Sep 20), how about GRCh37?

Copying the data from martdb (ensembldb2b) to EBI, same approach as ensembldb, should take <1w.

2016-08-10 ensembldb data transfer
Steve transferring ensembldb files using shadowland to EBI warehouse, will complete ~2w.

2016-07-22 ensembldb transfer updates
The internal Sanger mirror only has 2-3 releases. The only place we have it all is ensembldb2a|b in the DMZ, will take about 2.5 - 3 weeks.

2016-07-21 ensembldb transfer updates
Can use internal ensembldb mirror, we can copy that at the full 10G rate. That just leaves the biomart data from the DMZ which is a smaller data set. This will reduce transfer time greatly (Paul Bevan).

2016-08-05 HW ready
HW from initial purchase ready at EBI, need to send form for request

2016-07-15 Warehouse ready to accept DB files
300TB warehouse ready, can receive ensembldb/martdb files from Sanger
